<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>struct fence</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"><link rel="home" href="index.html" title="Linux Device Drivers"><link rel="up" href="ch02s03.html" title="Device Drivers DMA Management"><link rel="prev" href="re393.html" title="..//drivers/dma-buf/seqno-fence.c"><link rel="next" href="API-struct-fence-cb.html" title="struct fence_cb"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center"><span class="phrase">struct fence</span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="re393.html">Prev</a> </td><th width="60%" align="center">Device Drivers DMA Management</th><td width="20%" align="right"> <a accesskey="n" href="API-struct-fence-cb.html">Next</a></td></tr></table><hr></div><div class="refentry"><a name="API-struct-fence"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>struct fence — 
  software synchronization primitive
 </p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="programlisting">
struct fence {
  struct kref refcount;
  const struct fence_ops * ops;
  struct rcu_head rcu;
  struct list_head cb_list;
  spinlock_t * lock;
  unsigned context;
  unsigned seqno;
  unsigned long flags;
  ktime_t timestamp;
  int status;
};  </pre></div><div class="refsect1"><a name="idm16976"></a><h2>Members</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term">refcount</span></dt><dd><p>
refcount for this fence
      </p></dd><dt><span class="term">ops</span></dt><dd><p>
fence_ops associated with this fence
      </p></dd><dt><span class="term">rcu</span></dt><dd><p>
used for releasing fence with kfree_rcu
      </p></dd><dt><span class="term">cb_list</span></dt><dd><p>
list of all callbacks to call
      </p></dd><dt><span class="term">lock</span></dt><dd><p>
spin_lock_irqsave used for locking
      </p></dd><dt><span class="term">context</span></dt><dd><p>
execution context this fence belongs to, returned by
<code class="function">fence_context_alloc</code>
      </p></dd><dt><span class="term">seqno</span></dt><dd><p>
the sequence number of this fence inside the execution context,
can be compared to decide which fence would be signaled later.
      </p></dd><dt><span class="term">flags</span></dt><dd><p>
A mask of FENCE_FLAG_* defined below
      </p></dd><dt><span class="term">timestamp</span></dt><dd><p>
Timestamp when the fence was signaled.
      </p></dd><dt><span class="term">status</span></dt><dd><p>
Optional, only valid if &lt; 0, must be set before calling
fence_signal, indicates that the fence has completed with an error.
      </p></dd></dl></div></div><div class="refsect1"><a name="idm17020"></a><h2>Description</h2><p>
   the flags member must be manipulated and read using the appropriate
   atomic ops (bit_*), so taking the spinlock will not be needed most
   of the time.
   </p><p>

   FENCE_FLAG_SIGNALED_BIT - fence is already signaled
   FENCE_FLAG_ENABLE_SIGNAL_BIT - enable_signaling might have been called*
   FENCE_FLAG_USER_BITS - start of the unused bits, can be used by the
   implementer of the fence for its own purposes. Can be used in different
   ways by different fence implementers, so do not rely on this.
   </p><p>

   *) Since atomic bitops are used, this is not guaranteed to be the case.
   Particularly, if the bit was set, but fence_signal was called right
   before this bit was set, it would have been able to set the
   FENCE_FLAG_SIGNALED_BIT, before enable_signaling was called.
   Adding a check for FENCE_FLAG_SIGNALED_BIT after setting
   FENCE_FLAG_ENABLE_SIGNAL_BIT closes this race, and makes sure that
   after fence_signal was called, any enable_signaling call will have either
   been completed, or never called at all.
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="re393.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02s03.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="API-struct-fence-cb.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">
   ..//drivers/dma-buf/seqno-fence.c
   </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> <span class="phrase">struct fence_cb</span></td></tr></table></div></body></html>
